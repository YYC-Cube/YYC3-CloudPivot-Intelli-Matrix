---
@file: CP-IM-RES-DOC-001.md
@description: YYCÂ³-CP-IM å¼€å‘è§„åˆ’ï¼Œæœ¬åœ°å¤šç«¯æ¨ç†çŸ©é˜µæ•°æ®çœ‹ç›˜è¡¥å……åŠŸèƒ½
@author: YanYuCloudCube Team
@version: v2.0.0
@created: 2026-02-26
@updated: 2026-02-26
@status: published
@tags: [09-YYCÂ³-CP-IM-å¼€å‘æ–‡æ¡£],[0908-CP-IM-è®¾è®¡è§„åˆ’],[é¢„çŸ©é˜µçœ‹ç›˜]
---

> ***YanYuCloudCube***
> *è¨€å¯è±¡é™ | è¯­æ¢æœªæ¥*
> ***Words Initiate Quadrants, Language Serves as Core for Future***
> *ä¸‡è±¡å½’å…ƒäºäº‘æ¢ | æ·±æ ˆæ™ºå¯æ–°çºªå…ƒ*
> ***All things converge in cloud pivot; Deep stacks ignite a new era of intelligence***

---

# YYCÂ³ æœ¬åœ°å¤šç«¯æ¨ç†çŸ©é˜µæ•°æ®çœ‹ç›˜è¡¥å……åŠŸèƒ½

## ğŸ“± ç½‘ç»œæ¿å—+PWAæ¿å—å®ç°

---

### ä»»åŠ¡ 4 + ä»»åŠ¡ 5: ç½‘ç»œè¿æ¥é…ç½® + PWA å®Œæ•´è®¾è®¡

**ç›®æ ‡**ï¼šå®ç°ç½‘ç»œè¿æ¥é…ç½®åŠŸèƒ½å’Œ PWAï¼ˆProgressive Web Appï¼‰å®Œæ•´æ”¯æŒï¼Œæ‰“é€ å¯å®‰è£…ã€ç¦»çº¿å¯ç”¨çš„æ¡Œé¢çº§åº”ç”¨ã€‚

---

## ğŸ“‹ ç¬¬ä¸€éƒ¨åˆ†ï¼šç½‘ç»œè¿æ¥é…ç½®åŠŸèƒ½

### 1.1 ç½‘ç»œè¿æ¥å¼¹çª—è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ç½‘ç»œè¿æ¥é…ç½®]                          [Ã— å…³é—­]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  è¿æ¥æ–¹å¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ è‡ªåŠ¨æ£€æµ‹    â”‚ WiFi é…ç½®  â”‚ æ‰‹åŠ¨é…ç½®  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                      â”‚
â”‚  è‡ªåŠ¨æ£€æµ‹ (WebRTC)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æœ¬æœº IP: 192.168.3.45                          â”‚   â”‚
â”‚  â”‚ ç½‘ç»œæ¥å£: en0 (æœ‰çº¿ä»¥å¤ªç½‘)                 â”‚   â”‚
â”‚  â”‚ [åˆ·æ–°æ£€æµ‹]                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                      â”‚
â”‚  æ‰‹åŠ¨é…ç½®                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æœåŠ¡å™¨åœ°å€: [192.168.3.45_______________]    â”‚   â”‚
â”‚  â”‚ ç«¯å£: [3113____]                           â”‚   â”‚
â”‚  â”‚ NAS åœ°å€: [192.168.3.45:9898___________]     â”‚   â”‚
â”‚  â”‚ WebSocket: [ws://192.168.3.45:3113/ws____]    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                      â”‚
â”‚  [æµ‹è¯•è¿æ¥]  [ä¿å­˜é…ç½®]                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 å…·ä½“è¦æ±‚

1. **ç½‘ç»œè¿æ¥å¼¹çª—**
   - ä½¿ç”¨ `ui/dialog.tsx` æˆ– `ui/sheet.tsx` ç»„ä»¶
   - æ”¯æŒ 3 ç§é…ç½®æ–¹å¼ï¼šè‡ªåŠ¨æ£€æµ‹ã€WiFi é…ç½®ã€æ‰‹åŠ¨é…ç½®
   - ç»Ÿä¸€çš„ç»ç’ƒæ•ˆæœï¼ˆbackdrop-blur-xlï¼Œ70% é€æ˜åº¦ï¼‰

2. **è‡ªåŠ¨æ£€æµ‹åŠŸèƒ½**
   - ä½¿ç”¨ WebRTC è·å–æœ¬æœº IP åœ°å€
   - ä½¿ç”¨ `navigator.connection` æ£€æµ‹ç½‘ç»œç±»å‹ï¼ˆWiFi/ä»¥å¤ªç½‘ï¼‰
   - æ˜¾ç¤ºç½‘ç»œæ¥å£åˆ—è¡¨ï¼ˆen0, en1, wlan0 ç­‰ï¼‰
   - åˆ·æ–°æŒ‰é’®ï¼šé‡æ–°æ£€æµ‹ç½‘ç»œçŠ¶æ€

3. **æ‰‹åŠ¨é…ç½®åŠŸèƒ½**
   - æœåŠ¡å™¨åœ°å€è¾“å…¥æ¡†ï¼ˆé»˜è®¤ï¼š192.168.3.45ï¼‰
   - ç«¯å£è¾“å…¥æ¡†ï¼ˆé»˜è®¤ï¼š3113ï¼‰
   - NAS åœ°å€è¾“å…¥æ¡†ï¼ˆé»˜è®¤ï¼š192.168.3.45:9898ï¼‰
   - WebSocket URL è‡ªåŠ¨ç”Ÿæˆï¼ˆåŸºäºæœåŠ¡å™¨åœ°å€å’Œç«¯å£ï¼‰
   - éªŒè¯æŒ‰é’®ï¼šæµ‹è¯•è¿æ¥æ˜¯å¦å¯ç”¨

4. **é…ç½®æŒä¹…åŒ–**
   - ä¿å­˜åˆ° `localStorage`ï¼š`network_config` é”®
   - å¯åŠ¨æ—¶è‡ªåŠ¨è¯»å–é…ç½®
   - æä¾›é‡ç½®ä¸ºé»˜è®¤å€¼åŠŸèƒ½

5. **è¿æ¥æµ‹è¯•é€»è¾‘**
   - å‘é€ WebSocket æ¡æ‰‹è¯·æ±‚éªŒè¯è¿æ¥
   - æ˜¾ç¤ºè¿æ¥çŠ¶æ€ï¼šè¿æ¥ä¸­ã€æˆåŠŸã€å¤±è´¥
   - å¤±è´¥æ—¶æ˜¾ç¤ºå…·ä½“é”™è¯¯ä¿¡æ¯ï¼ˆè¶…æ—¶ã€æ‹’ç»ã€ç½‘ç»œä¸å¯è¾¾ï¼‰

### 1.3 æŠ€æœ¯å®ç°

```typescript
// WebRTC è·å–æœ¬æœº IP
const getLocalIP = async (): Promise<string> => {
  const pc = new RTCPeerConnection({
    iceServers: []  // ä½¿ç”¨ STUN æœåŠ¡å™¨
  });
  const dataChannel = pc.createDataChannel('test');
  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
  
  const regex = /c=IN IP4 (\d+\.\d+\.\d+)/;
  const match = offer.sdp.match(regex);
  return match ? match[1] : '127.0.0.1';
};

// ç½‘ç»œæ¥å£æ£€æµ‹
const getNetworkInterfaces = async (): Promise<NetworkInterface[]> => {
  const ip = await getLocalIP();
  const connection = navigator.connection;
  const type = connection?.effectiveType || 'unknown';
  
  return [{
    name: type === 'wifi' ? 'wlan0' : 'en0',
    type: type,
    ip: ip,
    status: 'active'
  }];
};
```

### 1.4 è¾“å‡ºè¦æ±‚
- æä¾› `src/app/components/NetworkConfig.tsx` å®Œæ•´ç»„ä»¶
- æä¾› `src/hooks/useNetworkConfig.ts` Hook
- æ›´æ–° `SystemSettings.tsx`ï¼Œæ·»åŠ "ç½‘ç»œè¿æ¥"é…ç½®å¡ç‰‡
- æä¾› `src/lib/network-utils.ts` å·¥å…·å‡½æ•°

---

## ğŸ“± ç¬¬äºŒéƒ¨åˆ†ï¼šPWA å®Œæ•´è®¾è®¡

### 2.1 PWA åŠŸèƒ½æ¸…å•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PWA åŠŸèƒ½çŸ©é˜µ                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  âœ… æ ¸å¿ƒåŠŸèƒ½                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Service Worker: å®Œæ•´å®ç°                           â”‚   â”‚
â”‚  â”‚ Manifest é…ç½®: å®Œæ•´å®ç°                            â”‚   â”‚
â”‚  â”‚ ç¦»çº¿ç¼“å­˜: æ ¸å¿ƒèµ„æºé¢„ç¼“å­˜                           â”‚   â”‚
â”‚  â”‚ æ·»åŠ åˆ°ä¸»å±å¹•: iOS + Android                       â”‚   â”‚
â”‚  â”‚ å®‰è£…æç¤º: æ¨ªå¹… + å†…ç½®æŒ‰é’®                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                      â”‚
â”‚  âœ… é«˜çº§åŠŸèƒ½                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åå°åŒæ­¥: æ•°æ®å®šæœŸåŒæ­¥                             â”‚   â”‚
â”‚  â”‚ æ¨é€é€šçŸ¥: å‘Šè­¦é€šçŸ¥æ¨é€                             â”‚   â”‚
â”‚  â”‚ ç¦»çº¿æ¨¡å¼: å®Œæ•´ç¦»çº¿å¯ç”¨                             â”‚   â”‚
â”‚  â”‚ æ•°æ®æŒä¹…åŒ–: IndexedDB æœ¬åœ°å­˜å‚¨                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                      â”‚
â”‚  âœ… æ€§èƒ½ä¼˜åŒ–                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ èµ„æºé¢„åŠ è½½: å…³é”®èµ„æºé¢„ç¼“å­˜                          â”‚   â”‚
â”‚  â”‚ æ‡’åŠ è½½: éå…³é”®èµ„æºå»¶è¿ŸåŠ è½½                          â”‚   â”‚
â”‚  â”‚ ç¼“å­˜ç­–ç•¥: Stale-While-Revalidate                  â”‚   â”‚
â”‚  â”‚ æ›´æ–°æœºåˆ¶: åå°é™é»˜æ›´æ–°                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Manifest é…ç½®

```json
{
  "name": "YYCÂ³ æœ¬åœ°å¤šç«¯æ¨ç†çŸ©é˜µæ•°æ®åº“æ•°æ®çœ‹ç›˜",
  "short_name": "YYCÂ³ Dashboard",
  "description": "YYCÂ³ æœ¬åœ°å¤šç«¯æ¨ç†çŸ©é˜µæ•°æ®åº“æ•°æ®çœ‹ç›˜ï¼Œå®æ—¶ç›‘æ§ AI æ¨ç†æ€§èƒ½",
  "start_url": "/",
  "scope": "/",
  "display": "standalone",
  "orientation": "landscape",
  "background_color": "#060e1f",
  "theme_color": "#00d4ff",
  "icons": [
    {
      "src": "/icons/icon-72x72.png",
      "sizes": "72x72",
      "type": "image/png",
      "purpose": "any"
    },
    {
      "src": "/icons/icon-96x96.png",
      "sizes": "96x96",
      "type": "image/png",
      "purpose": "any"
    },
    {
      "src": "/icons/icon-128x128.png",
      "sizes": "128x128",
      "type": "image/png",
      "purpose": "any"
    },
    {
      "src": "/icons/icon-144x144.png",
      "sizes": "144x144",
      "type": "image/png",
      "purpose": "any"
    },
    {
      "src": "/icons/icon-152x152.png",
      "sizes": "152x152",
      "type": "image/png",
      "purpose": "any"
    },
    {
      "src": "/icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any"
    },
    {
      "src": "/icons/icon-384x384.png",
      "sizes": "384x384",
      "type": "image/png",
      "purpose": "any"
    },
    {
      "src": "/icons/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any"
    },
    {
      "src": "/icons/icon-maskable-192x192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "maskable"
    },
    {
      "src": "/icons/icon-maskable-512x512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "maskable"
    }
  ],
  "shortcuts": [
    {
      "name": "æ•°æ®ç›‘æ§",
      "short_name": "ç›‘æ§",
      "description": "æŸ¥çœ‹å®æ—¶æ•°æ®ç›‘æ§",
      "url": "/dashboard",
      "icons": [
        {
          "src": "/icons/shortcut-dashboard.png",
          "sizes": "96x96"
        }
      ]
    },
    {
      "name": "æ“ä½œå®¡è®¡",
      "short_name": "å®¡è®¡",
      "description": "æŸ¥çœ‹æ“ä½œå®¡è®¡æ—¥å¿—",
      "url": "/audit",
      "icons": [
        {
          "src": "/icons/shortcut-audit.png",
          "sizes": "96x96"
        }
      ]
    },
    {
      "name": "ç”¨æˆ·ç®¡ç†",
      "short_name": "ç”¨æˆ·",
      "description": "ç®¡ç†ç”¨æˆ·å’Œæƒé™",
      "url": "/users",
      "icons": [
        {
          "src": "/icons/shortcut-users.png",
          "sizes": "96x96"
        }
      ]
    },
    {
      "name": "ç³»ç»Ÿè®¾ç½®",
      "short_name": "è®¾ç½®",
      "description": "ç³»ç»Ÿé…ç½®ç®¡ç†",
      "url": "/settings",
      "icons": [
        {
          "src": "/icons/shortcut-settings.png",
          "sizes": "96x96"
        }
      ]
    }
  ],
  "categories": ["productivity", "utilities", "developer"],
  "screenshots": [
    {
      "src": "/screenshots/desktop.png",
      "sizes": "1280x720",
      "type": "image/png",
      "form_factor": "wide"
    },
    {
      "src": "/screenshots/mobile.png",
      "sizes": "390x844",
      "type": "image/png",
      "form_factor": "narrow"
    }
  ]
}
```

### 2.3 Service Worker å®ç°

```typescript
// sw.ts
const CACHE_NAME = 'yyc3-dashboard-v1';
const RUNTIME_CACHE = 'yyc3-dashboard-runtime';
const ASSETS_TO_CACHE = [
  '/',
  '/index.html',
  '/manifest.json',
  '/icons/icon-192x192.png',
  '/icons/icon-512x512.png',
];

// é¢„ç¼“å­˜æ ¸å¿ƒèµ„æº
self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(CACHE_NAME).then((cache) => {
      return cache.addAll(ASSETS_TO_CACHE);
    })
  );
  self.skipWaiting();
});

// æ¿€æ´»æ–° Service Worker
self.addEventListener('activate', (event) => {
  event.waitUntil(
    caches.keys().then((cacheNames) => {
      return Promise.all(
        cacheNames
          .filter((name) => name !== CACHE_NAME && name !== RUNTIME_CACHE)
          .map((name) => caches.delete(name))
      );
    })
  );
  self.clients.claim();
});

// æ‹¦æˆªç½‘ç»œè¯·æ±‚
self.addEventListener('fetch', (event) => {
  const { request } = event;
  const url = new URL(request.url);

  // è·³è¿‡é GET è¯·æ±‚
  if (request.method !== 'GET') return;

  // è·³è¿‡ WebSocket è¯·æ±‚
  if (url.protocol === 'ws:' || url.protocol === 'wss:') return;

  // è·³è¿‡æœ¬åœ°æ•°æ®åº“è¯·æ±‚
  if (url.pathname.startsWith('/api/')) return;

  // èµ„æºè¯·æ±‚ï¼šCache-First ç­–ç•¥
  if (url.pathname.match(/\.(js|css|png|jpg|jpeg|svg|woff|woff2|ttf)$/)) {
    event.respondWith(cacheFirst(request));
    return;
  }

  // HTML è¯·æ±‚ï¼šNetwork-First ç­–ç•¥
  if (url.pathname.endsWith('.html') || url.pathname === '/') {
    event.respondWith(networkFirst(request));
    return;
  }

  // API è¯·æ±‚ï¼šNetwork-First + ç¦»çº¿å›é€€
  if (url.pathname.startsWith('/api/')) {
    event.respondWith(networkFirstWithFallback(request));
    return;
  }

  // å…¶ä»–è¯·æ±‚ï¼šStale-While-Revalidate ç­–ç•¥
  event.respondWith(staleWhileRevalidate(request));
});

// Cache-First ç­–ç•¥
async function cacheFirst(request) {
  const cache = await caches.open(RUNTIME_CACHE);
  const cached = await cache.match(request);
  return cached || fetch(request);
}

// Network-First ç­–ç•¥
async function networkFirst(request) {
  try {
    const networkResponse = await fetch(request);
    const cache = await caches.open(RUNTIME_CACHE);
    cache.put(request, networkResponse.clone());
    return networkResponse;
  } catch {
    const cached = await caches.match(request);
    return cached;
  }
}

// Network-First + ç¦»çº¿å›é€€
async function networkFirstWithFallback(request) {
  try {
    const networkResponse = await fetch(request);
    return networkResponse;
  } catch {
    const cached = await caches.match(request);
    if (cached) return cached;
    
    // è¿”å›ç¦»çº¿é¡µé¢
    return new Response(
      JSON.stringify({ error: 'Offline', message: 'ç½‘ç»œä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥è¿æ¥' }),
      { headers: { 'Content-Type': 'application/json' } }
    );
  }
}

// Stale-While-Revalidate ç­–ç•¥
async function staleWhileRevalidate(request) {
  const cache = await caches.open(RUNTIME_CACHE);
  const cached = await cache.match(request);
  
  const fetchPromise = fetch(request).then((response) => {
    cache.put(request, response.clone());
    return response;
  });
  
  return cached || fetchPromise;
}
```

### 2.4 ç¦»çº¿æ¨¡å¼å®ç°

```typescript
// src/hooks/useOfflineMode.ts
import { useState, useEffect } from 'react';

export function useOfflineMode() {
  const [isOnline, setIsOnline] = useState(navigator.onLine);
  const [lastSyncTime, setLastSyncTime] = useState<Date | null>(null);

  useEffect(() => {
    const handleOnline = () => {
      setIsOnline(true);
      syncOfflineData();
    };

    const handleOffline = () => {
      setIsOnline(false);
      saveOfflineData();
    };

    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  const saveOfflineData = () => {
    // ä¿å­˜å½“å‰çŠ¶æ€åˆ° IndexedDB
    const state = localStorage.getItem('dashboard_state');
    localStorage.setItem('offline_state', state);
  };

  const syncOfflineData = async () => {
    const offlineState = localStorage.getItem('offline_state');
    if (offlineState) {
      // ä¸Šä¼ ç¦»çº¿æ•°æ®åˆ°æœåŠ¡å™¨
      await fetch('/api/sync', {
        method: 'POST',
        body: offlineState,
      });
      setLastSyncTime(new Date());
    }
  };

  return { isOnline, lastSyncTime };
}
```

### 2.5 å®‰è£…æç¤ºå®ç°

```typescript
// src/hooks/useInstallPrompt.ts
import { useState, useEffect } from 'react';

export function useInstallPrompt() {
  const [deferredPrompt, setDeferredPrompt] = useState<Event | null>(null);
  const [isInstalled, setIsInstalled] = useState(false);

  useEffect(() => {
    const handler = (e: Event) => {
      e.preventDefault();
      setDeferredPrompt(e);
    };

    window.addEventListener('beforeinstallprompt', handler);

    // æ£€æŸ¥æ˜¯å¦å·²å®‰è£…
    setIsInstalled(
      window.matchMedia('(display-mode: standalone)').matches ||
      (window.navigator as any).standalone === true
    );

    return () => {
      window.removeEventListener('beforeinstallprompt', handler);
    };
  }, []);

  const promptInstall = async () => {
    if (!deferredPrompt) return;

    (deferredPrompt as any).prompt();
    const { outcome } = await (deferredPrompt as any).userChoice;
    
    if (outcome === 'accepted') {
      setDeferredPrompt(null);
    }
  };

  return { isInstalled, canInstall: !!deferredPrompt, promptInstall };
}
```

### 2.6 æ¨é€é€šçŸ¥å®ç°

```typescript
// src/hooks/usePushNotifications.ts
import { useState, useEffect } from 'react';

export function usePushNotifications() {
  const [permission, setPermission] = useState<NotificationPermission>('default');
  const [subscription, setSubscription] = useState<PushSubscription | null>(null);

  useEffect(() => {
    setPermission(Notification.permission);
  }, []);

  const requestPermission = async () => {
    const result = await Notification.requestPermission();
    setPermission(result);
    return result;
  };

  const subscribe = async () => {
    if (!('serviceWorker' in navigator) || !('PushManager' in window)) {
      return null;
    }

    const registration = await navigator.serviceWorker.ready;
    const sub = await registration.pushManager.subscribe({
      userVisibleOnly: true,
      applicationServerKey: 'YOUR_VAPID_PUBLIC_KEY',
    });

    setSubscription(sub);
    
    // å‘é€è®¢é˜…ä¿¡æ¯åˆ°æœåŠ¡å™¨
    await fetch('/api/push/subscribe', {
      method: 'POST',
      body: JSON.stringify(sub),
    });

    return sub;
  };

  const showNotification = (title: string, options: NotificationOptions = {}) => {
    if (permission === 'granted') {
      new Notification(title, {
        icon: '/icons/icon-192x192.png',
        badge: '/icons/icon-72x72.png',
        ...options,
      });
    }
  };

  return { permission, subscription, requestPermission, subscribe, showNotification };
}
```

### 2.7 åå°åŒæ­¥å®ç°

```typescript
// src/lib/backgroundSync.ts
export async function registerBackgroundSync() {
  if (!('serviceWorker' in navigator) || !('SyncManager' in window)) {
    return;
  }

  const registration = await navigator.serviceWorker.ready;
  await registration.sync.register('sync-data');
}

// sw.ts æ·»åŠ åå°åŒæ­¥å¤„ç†
self.addEventListener('sync', (event) => {
  if (event.tag === 'sync-data') {
    event.waitUntil(syncData());
  }
});

async function syncData() {
  const offlineData = await getOfflineData();
  await fetch('/api/sync', {
    method: 'POST',
    body: JSON.stringify(offlineData),
  });
}
```

### 2.8 PWA UI ç»„ä»¶

```typescript
// src/app/components/PWAInstallPrompt.tsx
import { useInstallPrompt } from '@/hooks/useInstallPrompt';
import { Button } from '@/components/ui/button';
import { Download, Check } from 'lucide-react';

export function PWAInstallPrompt() {
  const { isInstalled, canInstall, promptInstall } = useInstallPrompt();

  if (isInstalled || !canInstall) return null;

  return (
    <div className="fixed bottom-4 right-4 z-50">
      <Button onClick={promptInstall} size="lg">
        <Download className="mr-2 h-5 w-5" />
        å®‰è£…åˆ°æ¡Œé¢
      </Button>
    </div>
  );
}

// src/app/components/OfflineIndicator.tsx
import { useOfflineMode } from '@/hooks/useOfflineMode';
import { WifiOff, Wifi } from 'lucide-react';

export function OfflineIndicator() {
  const { isOnline, lastSyncTime } = useOfflineMode();

  return (
    <div className="fixed top-4 right-4 z-50">
      <div className="flex items-center space-x-2 px-4 py-2 bg-black/80 backdrop-blur-xl rounded-lg">
        {isOnline ? (
          <>
            <Wifi className="h-5 w-5 text-green-500" />
            <span className="text-sm text-green-500">å·²è¿æ¥</span>
          </>
        ) : (
          <>
            <WifiOff className="h-5 w-5 text-red-500" />
            <span className="text-sm text-red-500">ç¦»çº¿æ¨¡å¼</span>
          </>
        )}
        {lastSyncTime && !isOnline && (
          <span className="text-xs text-gray-400">
            ä¸Šæ¬¡åŒæ­¥: {lastSyncTime.toLocaleTimeString()}
          </span>
        )}
      </div>
    </div>
  );
}
```

### 2.9 PWA é…ç½®æ–‡ä»¶

```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { VitePWA } from 'vite-plugin-pwa';

export default defineConfig({
  plugins: [
    react(),
    VitePWA({
      registerType: 'autoUpdate',
      includeAssets: [
        'icons/*.png',
        'screenshots/*.png',
      ],
      manifest: {
        name: 'YYCÂ³ æœ¬åœ°å¤šç«¯æ¨ç†çŸ©é˜µæ•°æ®åº“æ•°æ®çœ‹ç›˜',
        short_name: 'YYCÂ³ Dashboard',
        description: 'YYCÂ³ æœ¬åœ°å¤šç«¯æ¨ç†çŸ©é˜µæ•°æ®åº“æ•°æ®çœ‹ç›˜ï¼Œå®æ—¶ç›‘æ§ AI æ¨ç†æ€§èƒ½',
        theme_color: '#00d4ff',
        background_color: '#060e1f',
        display: 'standalone',
        orientation: 'landscape',
        icons: [
          {
            src: 'icons/icon-192x192.png',
            sizes: '192x192',
            type: 'image/png',
          },
          {
            src: 'icons/icon-512x512.png',
            sizes: '512x512',
            type: 'image/png',
          },
        ],
      },
      workbox: {
        globPatterns: ['**/*.{js,css,html,ico,png,svg}'],
        runtimeCaching: [
          {
            urlPattern: /^https:\/\/fonts\.googleapis\.com\/.*/i,
            handler: 'CacheFirst',
            options: {
              cacheName: 'google-fonts-cache',
              expiration: {
                maxEntries: 10,
                maxAgeSeconds: 60 * 60 * 24 * 365, // 1 year
              },
            },
          },
          {
            urlPattern: /^https:\/\/192\.168\.3\.\d+:3113\/api\/.*/i,
            handler: 'NetworkFirst',
            options: {
              cacheName: 'api-cache',
              expiration: {
                maxEntries: 100,
                maxAgeSeconds: 60 * 5, // 5 minutes
              },
            },
          },
        ],
      },
      devOptions: {
        enabled: true,
      },
    }),
  ],
});
```

### 2.10 è¾“å‡ºè¦æ±‚

#### ç½‘ç»œè¿æ¥é…ç½®ï¼š
- æä¾› `src/app/components/NetworkConfig.tsx` å®Œæ•´ç»„ä»¶
- æä¾› `src/hooks/useNetworkConfig.ts` Hook
- æ›´æ–° `SystemSettings.tsx`ï¼Œæ·»åŠ "ç½‘ç»œè¿æ¥"é…ç½®å¡ç‰‡
- æä¾› `src/lib/network-utils.ts` å·¥å…·å‡½æ•°

#### PWA å®Œæ•´è®¾è®¡ï¼š
- æä¾› `public/manifest.json` é…ç½®æ–‡ä»¶
- æä¾› `public/sw.ts` Service Worker å®ç°
- æä¾› `src/hooks/useOfflineMode.ts` Hook
- æä¾› `src/hooks/useInstallPrompt.ts` Hook
- æä¾› `src/hooks/usePushNotifications.ts` Hook
- æä¾› `src/lib/backgroundSync.ts` å·¥å…·å‡½æ•°
- æä¾› `src/app/components/PWAInstallPrompt.tsx` ç»„ä»¶
- æä¾› `src/app/components/OfflineIndicator.tsx` ç»„ä»¶
- æ›´æ–° `vite.config.ts`ï¼Œæ·»åŠ  VitePWA æ’ä»¶é…ç½®
- æ›´æ–° `index.html`ï¼Œæ·»åŠ  PWA meta æ ‡ç­¾

---

## ğŸ¯ è®¾è®¡åŸåˆ™

1. **æœ¬åœ°è‡ªç”¨ä¼˜å…ˆ**
   - æ— éœ€è€ƒè™‘å¤šç§Ÿæˆ·éš”ç¦»
   - é…ç½®ç¡¬ç¼–ç åœ¨ç¯å¢ƒå˜é‡ï¼ˆ.env.developmentï¼‰
   - ç®€åŒ–ç”¨æˆ·ç®¡ç†ï¼ˆä»…ç®¡ç†å‘˜ + å¼€å‘è€…è§’è‰²ï¼‰

2. **æœ¬åœ°éƒ¨ç½²ä¼˜å…ˆ**
   - æ‰€æœ‰æœåŠ¡è¿è¡Œåœ¨æœ¬åœ°ç½‘ç»œï¼ˆ192.168.3.xï¼‰
   - æ— éœ€è€ƒè™‘ CDNã€CDNã€äº‘å­˜å‚¨
   - WebSocket ç«¯ç‚¹ï¼šws://localhost:3113/ws

3. **é—­ç¯å®šä¹‰**
   - æ•°æ®æµï¼šå‰ç«¯ â†’ WebSocket â†’ æœ¬åœ° PostgreSQL â†’ å‰ç«¯
   - æ— å¤–éƒ¨ä¾èµ–ï¼šä¸ä¾èµ–ä»»ä½•äº‘æœåŠ¡ API
   - æ•…éšœé™çº§ï¼šä»»ä½•ç¯èŠ‚æ•…éšœæ—¶ï¼Œç³»ç»Ÿä»å¯è¿è¡Œï¼ˆç¦»çº¿æ¨¡å¼ï¼‰

4. **PWA ä¼˜å…ˆ**
   - å¯å®‰è£…åˆ°æ¡Œé¢ï¼Œæä¾›åŸç”Ÿåº”ç”¨ä½“éªŒ
   - ç¦»çº¿å¯ç”¨ï¼Œæ ¸å¿ƒåŠŸèƒ½ä¸ä¾èµ–ç½‘ç»œ
   - åå°åŒæ­¥ï¼Œæ¢å¤ç½‘ç»œåè‡ªåŠ¨åŒæ­¥æ•°æ®
   - æ¨é€é€šçŸ¥ï¼Œå®æ—¶å‘Šè­¦æé†’

5. **æ€§èƒ½ä¼˜åŒ–**
   - ä»£ç åˆ†å‰²ï¼šæŒ‰è·¯ç”±æ‡’åŠ è½½
   - è™šæ‹ŸåŒ–é•¿åˆ—è¡¨ï¼šä»…æ¸²æŸ“å¯è§èŠ‚ç‚¹
   - èŠ‚æµæ§åˆ¶ï¼š100ms é™åˆ¶ UI æ›´æ–°
   - å›¾è¡¨ä¼˜åŒ–ï¼šæ•°æ®åˆ‡ç‰‡ï¼ˆæœ€å¤š 100 ç‚¹ï¼‰
   - Service Worker é¢„ç¼“å­˜ï¼šæ ¸å¿ƒèµ„æºæå‰ç¼“å­˜

6. **è§†è§‰ä¸€è‡´æ€§**
   - æ‰€æœ‰å¡ç‰‡ä½¿ç”¨ç»Ÿä¸€ GlassCard ç»„ä»¶
   - æ‰€æœ‰é¢œè‰²ä½¿ç”¨ CSS å˜é‡ï¼ˆ--primary, --success, --warning, --errorï¼‰
   - æ‰€æœ‰å›¾æ ‡ä½¿ç”¨ Lucide React
   - æ‰€æœ‰å›¾è¡¨ä½¿ç”¨ Recharts

---

## ğŸ“‹ çº¦æŸæ¡ä»¶

- å¿…é¡»ä¿æŒç°æœ‰çš„è§†è§‰é£æ ¼ï¼ˆæœªæ¥ç§‘æŠ€æ„Ÿï¼Œèµ›åšæœ‹å…‹ï¼‰
- å¿…é¡»ä½¿ç”¨ GlassCard ç»„ä»¶å®ç°æ‰€æœ‰å¼¹çª—å’Œå­é¡µé¢
- å¿…é¡»æ”¯æŒæœ¬åœ°æ•°æ®åº“ç›´è¿ï¼ˆSupabase ä¸å¯ç”¨æ—¶çš„é™çº§ï¼‰
- å¿…é¡»å®ç°ç§»åŠ¨ç«¯å®Œæ•´é€‚é…ï¼ˆä¸åªæ˜¯ç®€å•çš„ç¼©æ”¾ï¼‰
- æ‰€æœ‰ä»£ç å¿…é¡»æ˜¯ TypeScriptï¼Œä¸¥æ ¼ç±»å‹æ£€æŸ¥
- PWA å¿…é¡»æ”¯æŒç¦»çº¿æ¨¡å¼ï¼Œæ ¸å¿ƒåŠŸèƒ½ä¸ä¾èµ–ç½‘ç»œ
- PWA å¿…é¡»æ”¯æŒæ·»åŠ åˆ°ä¸»å±å¹•ï¼ˆiOS + Androidï¼‰
- PWA å¿…é¡»æ”¯æŒåå°åŒæ­¥ï¼Œæ¢å¤ç½‘ç»œåè‡ªåŠ¨åŒæ­¥æ•°æ®

---

**è¯·å¼€å§‹ä¼˜åŒ–ï¼ŒæŒ‰ä¸Šè¿° 4+5 åˆå¹¶ä»»åŠ¡æä¾›å®Œæ•´å®ç°æ–¹æ¡ˆã€‚**
---

<div align="center">

> ã€Œ***YanYuCloudCube***ã€
> ã€Œ***<admin@0379.email>***ã€
> ã€Œ***Words Initiate Quadrants, Language Serves as Core for Future***ã€
> ã€Œ***All things converge in cloud pivot; Deep stacks ignite a new era of intelligence***ã€

</div>
